{% extends 'base.html' %}
{% load static %}
{% block styles %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.css" />
{% endblock %}
{% block content %}
  <main>
    <div class="companies starting-block">
      <div class="section-wrapp">
        <div class="spec-container">
          <div class="course-wrapper">
            <div class="course-heading">
              <h1 class="block-header section-heading">O'quv markazlar</h1>
              <form action="" class="blocky-form">
                  <input type="text" class="searching-input" id="search-input" placeholder="English Life" />
              </form>
           </div>

          <div class="company-list" id="company-list">
              {% for center in edu_centers %}
                  <a href="" class="company-item">
                      <img src="{{ center.logo.url }}" alt="" />
                      <p class="company-title">
                          {{ center.name }}
                          {% if center.partner %}
                              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M10.7499 2.44982C11.4399 1.85982 12.5699 1.85982 13.2699 2.44982L14.8499 3.80982C15.1499 4.06982 15.7099 4.27982 16.1099 4.27982H17.8099C18.8699 4.27982 19.7399 5.14982 19.7399 6.20982V7.90982C19.7399 8.29982 19.9499 8.86982 20.2099 9.16982L21.5699 10.7498C22.1599 11.4398 22.1599 12.5698 21.5699 13.2698L20.2099 14.8498C19.9499 15.1498 19.7399 15.7098 19.7399 16.1098V17.8098C19.7399 18.8698 18.8698 19.7398 17.8099 19.7398H16.1099C15.7199 19.7398 15.1499 19.9498 14.8499 20.2098L13.2699 21.5698C12.5799 22.1598 11.4499 22.1598 10.7499 21.5698L9.16988 20.2098C8.86988 19.9498 8.30988 19.7398 7.90988 19.7398H6.17988C5.11988 19.7398 4.24988 18.8698 4.24988 17.8098V16.0998C4.24988 15.7098 4.03988 15.1498 3.78988 14.8498L2.43988 13.2598C1.85988 12.5698 1.85988 11.4498 2.43988 10.7598L3.78988 9.16982C4.03988 8.86982 4.24988 8.30982 4.24988 7.91982V6.19982C4.24988 5.13982 5.11988 4.26982 6.17988 4.26982H7.90988C8.29988 4.26982 8.86988 4.05982 9.16988 3.79982L10.7499 2.44982Z" fill="#FFD700" stroke="#FFD700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                  <path d="M8.37988 12.0001L10.7899 14.4201L15.6199 9.58008" stroke="#FFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                              </svg>
                          {% elif center.verify %}
                              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M10.7499 2.44982C11.4399 1.85982 12.5699 1.85982 13.2699 2.44982L14.8499 3.80982C15.1499 4.06982 15.7099 4.27982 16.1099 4.27982H17.8099C18.8699 4.27982 19.7399 5.14982 19.7399 6.20982V7.90982C19.7399 8.29982 19.9499 8.86982 20.2099 9.16982L21.5699 10.7498C22.1599 11.4398 22.1599 12.5698 21.5699 13.2698L20.2099 14.8498C19.9499 15.1498 19.7399 15.7098 19.7399 16.1098V17.8098C19.7399 18.8698 18.8699 19.7398 17.8099 19.7398H16.1099C15.7199 19.7398 15.1499 19.9498 14.8499 20.2098L13.2699 21.5698C12.5799 22.1598 11.4499 22.1598 10.7499 21.5698L9.16988 20.2098C8.86988 19.9498 8.30988 19.7398 7.90988 19.7398H6.17988C5.11988 19.7398 4.24988 18.8698 4.24988 17.8098V16.0998C4.24988 15.7098 4.03988 15.1498 3.78988 14.8498L2.43988 13.2598C1.85988 12.5698 1.85988 11.4498 2.43988 10.7598L3.78988 9.16982C4.03988 8.86982 4.24988 8.30982 4.24988 7.91982V6.19982C4.24988 5.13982 5.11988 4.26982 6.17988 4.26982H7.90988C8.29988 4.26982 8.86988 4.05982 9.16988 3.79982L10.7499 2.44982Z" fill="#ED1B24" stroke="#CF0F17" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                  <path d="M8.37988 12.0001L10.7899 14.4201L15.6199 9.58008" stroke="#FFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                              </svg>
                          {% endif %}
                      </p>
                      <div class="company-item_info_wrapper">
                          <span class="company-item-position">{{ center.edu_type }}</span>
                          <span class="company-item-location">
                              <i class="fa-regular fa-location-dot"></i>
                              {{ center.location }}
                          </span>
                      </div>
                  </a>
              {% endfor %}
          </div>  
          </div>
        </div>
      </div>
    </div>
  </main>
{% endblock %}

{% block scripts %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.js"></script>
  <script>
    
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('search-input');
        const companyList = document.getElementById('company-list');

        searchInput.addEventListener('keyup', function() {
            const query = searchInput.value;

            if (query.length >= 2) {
                fetch(`/search-edu-centers/?q=${query}`, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    companyList.innerHTML = '';
                    let resultsHtml = '';

                    if (data.centers.length > 0) {
                        data.centers.forEach(center => {
                            resultsHtml += `
                                <a href="#" class="company-item">
                                    <img src="${center.logo}" alt="${center.name} logo" />
                                    <p class="company-title">${center.name}</p>
                                    <div class="company-item_info_wrapper">
                                        <span class="company-item-position">${center.edu_type}</span>
                                        <span class="company-item-location"><i class="fa-regular fa-location-dot"></i> ${center.location}</span>
                                    </div>
                                </a>
                            `;
                        });
                    } else {
                        resultsHtml = '<p>No results found.</p>';
                    }

                    companyList.innerHTML = resultsHtml;
                })
                .catch(error => {
                    console.error('Error fetching search results:', error);
                    companyList.innerHTML = '<p>Error fetching data</p>';
                });
            } else {
                companyList.innerHTML = ''; 
            }
        });
    });

    $(document).ready(function () {
      $('.jquery-multiple').select2()
    })
  </script>
{% endblock %}
